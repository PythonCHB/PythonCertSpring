\documentclass{beamer}
%\usepackage[latin1]{inputenc}
\usetheme{Warsaw}
\title[Python Certificate: System Development]{Week 3: Advanced OO and Special Topics}
\author{Christopher Barker}
\institute{UW Continuing Education}
\date{March 26, 2013}

\usepackage{listings}
\usepackage{hyperref}

\begin{document}

% ---------------------------------------------
\begin{frame}
  \titlepage
\end{frame}

% ---------------------------------------------
\begin{frame}
\frametitle{Table of Contents}
%\tableofcontents[currentsection]
  \tableofcontents
\end{frame}


\begin{frame}[fragile]{A diversion...}

\Large{A number of you are already using \verb|iPython|}

\vfill
\Large{It's a very useful tool}

\vfill
\Large{And the \verb|iPython| notebook is even cooler .. paticularly for in-class demos.}

\vfill
\Large{So I'll use it some today:}

\vfill
\url{http://ipython.org/ipython-doc/dev/interactive/htmlnotebook.html}


\end{frame}

\begin{frame}[fragile]{String formating...}

\Large{A handy note about something that came up in last week's debugging excercise:}

\vfill
\small{
\begin{verbatim}
>>> print "%f, %f"%(fp, complex)
------------------------------------------
NameError                                 
----> 1 print "%f, %f"%(fp, complex)

NameError: name 'fp' is not defined
\end{verbatim}
}

\vfill
\large{(Demo in the iPython notebook...)}

\end{frame}


\section{lambda}

% ---------------------------------------------
\begin{frame}[fragile]{lambda}

\vfill
\Large{We didn't get to it last class, so let's do it now:}

\vfill
\url{https://docs.google.com/presentation/d/1GMMrDXzYFMFRn9ufrVUGb0vSBGO7VkV6GLAdu46CVzA/pub?start=false&loop=false&delayms=3000}

(that should be clickable...)
\vfill
If not, open: \verb'code\link_to_lambda_slides.html'

\end{frame}

\section{Decorators}

% ---------------------------------------------
\begin{frame}[fragile]{Decorators}

{\LARGE Decorators are wrappers around functions}

\vfill
{\LARGE They let you add code before and after the execution of a function}

\vfill
{\LARGE Creating a custom version of that function}

\end{frame} 

% ---------------------------------------------
\begin{frame}[fragile]{Decorators}

{\LARGE Syntax:}

\vfill
\begin{verbatim}
@logged
def add(a, b):
    """add() adds things"""
    return a + b
\end{verbatim}

\vfill
{\Large Demo and Motivation: \\
 \verb|code\decorators\basicmath.py| }

\vfill
PEP: \url{http://www.python.org/dev/peps/pep-0318/}

\end{frame} 

% ---------------------------------------------
\begin{frame}[fragile]{Decorators}

{\LARGE \verb|@| decorator operator is an abbreviation:}

\vfill
\begin{verbatim}
@f
def g:
    pass
\end{verbatim}

\vfill
same as

\vfill
\begin{verbatim}
def g:
    pass
g = f(g)
\end{verbatim}

\vfill
{\Large ``Syntactic Sugar'' -- but really quite nice}

\end{frame} 

% ---------------------------------------------
\begin{frame}[fragile]{Decorators}

{\LARGE demo:

\vfill
\begin{verbatim}
code\decorators\DecoratorDemo.py
\end{verbatim}

}
\end{frame} 

% ---------------------------------------------
\begin{frame}[fragile]{Decorator  examples}

{\LARGE Examples from the stdlib:}

\vfill
{\Large Does this structure:}

\vfill
\begin{verbatim}
def g:
    pass
g = f(g)
\end{verbatim}

\vfill

{\Large look familiar ?}
\end{frame} 

% ---------------------------------------------
\begin{frame}[fragile]{Decorator examples}

{\LARGE \verb|staticmethod()|}

\vfill
\begin{verbatim}
￼class C(object):
    def add(a, b):
        return a + b
    add = staticmethod(add)
\end{verbatim}

\vfill

\end{frame} 

% ---------------------------------------------
\begin{frame}[fragile]{Decorator examples}

{\LARGE \verb|staticmethod()|}

\vfill
{\Large Decorator form:}
\begin{verbatim}
￼class C(object):
    @staticmethod
    def add(a, b):
        return a + b
\end{verbatim}

\vfill

{\LARGE ( and \verb|classmethod| )}
\end{frame} 

% ---------------------------------------------
\begin{frame}[fragile]{examples}

{\LARGE \verb|property()|}

\vfill
\begin{verbatim}
￼￼class C(object):
    def __init__(self):
        self._x = None
    def getx(self):
        return self._x
    def setx(self, value):
        self._x = value
    def delx(self):
        del self._x
    x = property(getx, setx, delx,
                 "I'm the 'x' property.")
\end{verbatim}

\vfill
becomes...
\end{frame} 

% ---------------------------------------------
\begin{frame}[fragile]{Decorator examples}

\begin{verbatim}
class C(object):
    def __init__(self):
        self._x = None
    @property
    def x(self):
        return self._x
    @x.setter
    def x(self, value):
        self._x = value
    @x.deleter
    def x(self):
        del self._x
\end{verbatim}

\vfill
Puts the info close to where it is used
\end{frame} 

% ---------------------------------------------
\begin{frame}[fragile]{examples}

{\LARGE CherryPy}

\vfill
\begin{verbatim}
import cherrypy
class HelloWorld(object):
    @cherrypy.expose
    def index(self):
        return "Hello World!"
cherrypy.quickstart(HelloWorld())
\end{verbatim}

\end{frame} 

% ---------------------------------------------
\begin{frame}[fragile]{examples}

{\LARGE Pyramid}

\vfill
\begin{verbatim}

@template
def A_view_function(request)
   .....
@json
def A_view_function(request)
   ......


\end{verbatim}

so you don't need to think about what your view is returning...

\end{frame} 


% ---------------------------------------------
\begin{frame}[fragile]{decorators...}

{\Large For this class:}

\vfill
{\Large Mostly want to you to know how to use decorators that someone else has written}

\vfill
{\Large Have a basic idea what they do when you do use them}

\vfill
{\large A nice intro (and talks about closures...):}\\
\url{http://simeonfranklin.com/blog/2012/jul/1/python-decorators-in-12-steps/}

\end{frame} 

%-------------------------------
\begin{frame}[fragile]{LAB}

\begin{itemize}
  \item Write a decorator that can be used to wrap any function that returns a string in a \verb|<p>| element -- auto-generation of simple html.\\
 (\verb|p_wrapper.py|)      

  \item Try using a class to make a decorator that will wrap a
   specified tag around a function that returns a string:
   \begin{verbatim}
   @tag_wrapper('h1')
   def func2(x, y=4, z=2):
       return "the sum of %s and %s and %s is %s"%(x, y, z, x+y+z)

   >>> print func2(3,4)
   <h1>the sum of 3 and 4 and 2 is 9</h1>
   \end{verbatim}
\end{itemize}

\end{frame}



\section{Advanced-OO}

\section{Properties}

% ---------------------------------------------
\begin{frame}[fragile]{Accessing Attributes}

{\Large One of the strengths of Python is lack of clutter}

\vfill
{\Large Simple attributes:}

\begin{verbatim}
In [5]: class C(object):
        def __init__(self):
                self.x = 5
In [6]: c = C()
In [7]: c.x
Out[7]: 5
In [8]: c.x = 8
\end{verbatim}

\end{frame} 

% ---------------------------------------------
\begin{frame}[fragile]{Getter and Setters?}

{\Large What if you need to add behavior later?}

\begin{itemize}
  \item do some calculation
  \item check data validity
  \item keep things in sync
\end{itemize}

\end{frame}


\begin{frame}[fragile]{Getter and Setters?}

\begin{verbatim}
class C(object):
    def get_x(self):
        return self.x
    def set_x(self, x):
        self.x = x
>>> c = C()
>>> c.get_x()
>>> 5
>>> c.set_x(8)
>>> c.get_x()
>>> 8
\end{verbatim}
{\Large Ugly and verbose -- Java?}

\url{http://dirtsimple.org/2004/12/python-is-not-java.html}

\end{frame} 

\begin{frame}[fragile]{properties}

{ \Large When (and if) you need them: }

\begin{verbatim}
class C(object):
    def getx(self):
        return self._x
    def setx(self, value):
        self._x = value
    def delx(self):
        del self._x
    x = property(getx, setx, delx, "docstring")
\end{verbatim}
{\Large Interface is still like simple attribute access}
(\verb|properties_sample.py| )
\end{frame} 


\begin{frame}[fragile]{properties}

{ \Large When (and if) you need them: }

\begin{verbatim}
class C(object):
    def getx(self):
        return self._x
    def setx(self, value):
        self._x = value
    def delx(self):
        del self._x
    x = property(getx, setx, delx, "docstring")
\end{verbatim}
{\Large Interface is still like simple attribute access}
(\verb|properties_sample.py| )
\end{frame} 

\begin{frame}[fragile]{staticmethod}

{ \Large A method that doesn't get self! }

\begin{verbatim}
class C(object):
    def add(a, b):
        return a + b
    add = staticmethod(add)
>>> C.add(3,4)
7
>>> c = C()
>>> c.add(2, 2)
4
\end{verbatim}
{\Large When you don't need self -- can be used from either an instance or the class itself}

\vfill
see: \verb|static_method.py|
\end{frame} 

\begin{frame}[fragile]{classmethod}

{ \Large Method gets the class object, rather than an instance the first argument}

\begin{verbatim}
class C(object):
    def __init__(self, x, y):
        self.x = x
        self.y = y
    def a_class_method(klass, y):
        print "in a_class_method", klass
        return klass( y, y**2 )
    a_class_method = classmethod(a_class_method)
\end{verbatim}
{\Large When you need the class object rather than an instance -- plays well with subclassing}
\vfill
see: \verb|class_method.py|
\end{frame} 

\begin{frame}[fragile]{dict.fromkeys()}

{ \Large \verb|classmethod| often used for alternate constructors:}

\begin{verbatim}
>>> d = dict([1,2,3])
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
TypeError: cannot convert dictionary update
sequence element #0 to a sequence
>>> d = dict.fromkeys([1,2,3])
>>> d
{1: None, 2: None, 3: None}
\end{verbatim}

\end{frame} 

\begin{frame}[fragile]{dict.fromkeys()}

\begin{verbatim}
￼class Dict: ...
    def fromkeys(klass, iterable, value=None):
        "Emulate dict_fromkeys() in dictobject.c"
        d = klass()
        for key in iterable:
            d[key] = value
        return d
    fromkeys = classmethod(fromkeys)
\end{verbatim}

\vfill
{\Large See also datetime.datetime.now(), etc....}

\vfill
For a low-level look:\\
\url{http://docs.python.org/howto/descriptor.html}

\end{frame} 

\begin{frame}[fragile]{super}

{\Large getting the superclass:}
\begin{verbatim}
￼class SafeVehicle(Vehicle):
    """
    Safe Vehicle subclass of Vehicle base class...
    """
    def __init__(self, position=0, velocity=0, icon='S'):
        Vehicle.__init__(self, position, velocity, icon)
\end{verbatim}

{\Large
\vfill
not DRY
\vfill
also, what if we had a bunch of references to superclass?
}
\end{frame} 

\begin{frame}[fragile]{super}

{\Large getting the superclass:}
\begin{verbatim}
￼class SafeVehicle(Vehicle):
    """
    Safe Vehicle subclass of Vehicle base class
    """
    def __init__(self, position=0, velocity=0, icon='S'):
        super(SafeVehicle, self).__init__(position, velocity, icon)
\end{verbatim}

\vfill
{\Large ``super() considered super!'' by Raymond Hettinger }
\vfill
\url{http://rhettinger.wordpress.com/2011/05/26/super-considered-super/}
\vfill
 maybe use super() for your html subclassing...
\end{frame} 


%-------------------------------
\begin{frame}[fragile]{LAB}

\begin{itemize}
  \item Write a \verb|Circle| class with decorator syntax for properties:
  \begin{itemize}
  \item instantiate with a radius: \verb|c = Circle(4)|
  \item use a property for the diameter: get and settable:\\
        \verb|d = c.diameter| \\
        \verb|c.diameter = 5|
  \item use a property for the area: only gettable\\
        \verb|a = c.area| \\
        \verb|a.area = 5 => AttributeError|
  \end{itemize}
        (\verb|circle_properties.py| and \verb|test_circle_properties.py|)
  \vspace{0.5in}
\end{itemize}

\end{frame}

%\section{Initializing classes}

%\section{super()}

%\section{mix-ins}

%\section{meta-classes}


%-------------------------------
\begin{frame}[fragile]{Wrap up}

\vfill
{\Large A better understanding of the underpinnings of OO in Python?}

\vfill
{\Large Do you see a use for any of this in your projects?}

\vfill

\end{frame}

%-------------------------------
\begin{frame}[fragile]{Next Week:}

\vfill
{\LARGE Relational databases, SQL}

\vfill
{\Large  -- Jeff}

\vfill
{\Large And of course, your projects...}

\vfill

\end{frame}

%-------------------------------
\begin{frame}[fragile]{Project Time!}

\begin{itemize}
    \item Have you got your structure in place? 
    \item Are your goals clear?
    \item Anyone want a public code review?
    \item Let's get to work!
\end{itemize}

\end{frame}

\end{document}
 